/*
 exp-charts 2016-06-27 
*/
var exp={};exp.charts={},exp.controls={},function(){function a(a){function b(a){var b;return"x"==a?b="translate("+e.chartContainer.getWidth()/2+","+e.labelOffset+")":"y"==a&&(b="translate(-"+e.labelOffset+","+e.chartContainer.getHeight()/2+") rotate(-90)"),b}function c(a){return"x"==a?"bottom":"left"}function d(){return e.gridlines?"x"==e.type?-1*e.chartContainer.getHeight():-1*e.chartContainer.getWidth():0}var e=this;if(e.type=a.type,e.chartContainer=a.chartContainer,e.labelText=a.labelText,e.labelOffset=a.labelOffset,e.scale=a.scale,e.tickFormat=a.tickFormat,e.gridlines=a.gridlines||!1,e.ticks=a.ticks||5,e.axisG=null,e.axis=null,"x"!=e.type&&"y"!=e.type)throw new Error("Axis type can be either 'x' or 'y'");var f=e.chartContainer.getChartArea();e.axisG=f.append("g").attr("class","x"==e.type?"x axis":"y axis"),"x"==e.type&&e.axisG.attr("transform","translate(0,"+e.chartContainer.getHeight()+")"),e.axisLabel=e.axisG.append("text").style("text-anchor","middle").attr("transform",b(e.type)).attr("class","label").text(e.labelText),e.axis=d3.svg.axis().scale(e.scale).orient(c(e.type)).ticks(e.ticks).innerTickSize(d()).outerTickSize(0).tickFormat(e.tickFormat)}exp.axis=a,a.prototype.load=function(){this.axisG.call(this.axis)}}(),function(){function a(a,b,c,d){this.svgSelector=a,this.width=b,this.height=c,this.margin=d;var e=d3.select(this.svgSelector).attr("width",b).attr("height",c);e.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",this.width-d.left-d.right).attr("height",this.height-d.top-d.bottom);this.chartArea=e.append("g").attr("height",this.getHeight()).attr("width",this.getWidth()).attr("transform","translate("+d.left+","+d.top+")")}exp.container=a,a.prototype.getHeight=function(){return this.height-this.margin.top-this.margin.bottom},a.prototype.getWidth=function(){return this.width-this.margin.left-this.margin.right},a.prototype.getChartArea=function(){return this.chartArea}}(),function(){function a(a){this.chartArea=a.chartArea,this.xCallback=a.xCallback,this.yCallback=a.yCallback,this.xScale=a.xScale,this.yScale=a.yScale,this.xGuidelines=a.xGuidelines||!1,this.yGuidelines=a.yGuidelines||!1,this.color="#0000ff",this.id="0",this.path=this.chartArea.append("path").attr("class","chart-line"),this.ln=d3.svg.line().x(a.xCallback).y(a.yCallback);var b={chartArea:this.chartArea,xFormat:d3.time.format("%B %d, %Y"),yFormat:d3.format(","),color:this.color};this.tooltip=new exp.tooltip(b)}exp.line=a,a.prototype.load=function(a,b,c){var d=this;c&&(d.data=c.data,d.color=c.color,d.id=c.id),d.path.attr("d",d.ln(d.data)).style("stroke",d.color),d.tooltip.setColor(d.color),d.chartArea.selectAll(".line-point.line"+d.id).remove();var e=d.chartArea.selectAll("dot").data(d.data);e.enter().append("g").style("opacity",0).attr("class","line-point line"+d.id).attr("fill",d.color).on("mouseover",function(a){var b="marker"==d3.event.target.getAttribute("class");if(b){var c=200;d3.select(this).transition().duration(c).style("opacity",1);var e=parseFloat(d3.select(this).select("circle").attr("cx"))+5,f=parseFloat(d3.select(this).select("circle").attr("cy"))+5,g=d3.select(this).data()[0].x,h=d3.select(this).data()[0].y;d.tooltip.render(e,f,g,h,c)}}).on("mouseout",function(a){var b="marker"==d3.event.target.getAttribute("class");b&&(d3.select(this).transition().duration(200).style("opacity",0),d.tooltip.hide())}),e.append("circle").attr("r",5).attr("class","marker").attr("cx",d.xCallback).attr("cy",d.yCallback),d.xGuidelines&&e.append("line").attr("class","guideline").attr("x1",d.xCallback).attr("y1",d.yScale(b[0])).attr("x2",d.xCallback).attr("y2",d.yScale(b[1])),d.yGuidelines&&e.append("line").attr("class","guideline").attr("x1",d.xScale(a[0])).attr("y1",d.yCallback).attr("x2",d.xScale(a[1])).attr("y2",d.yCallback)}}(),function(){function a(a,m,n){function o(a){var b,c,d,e,f,g,h,i,j=function(a){return a[x]},k=function(a){return a[y]};for(h in a)i=a[h].data,f=d3.extent(i,j),(!b||f[0].getTime()<b.getTime())&&(b=f[0]),(!c||f[1].getTime()>c.getTime())&&(c=f[1]),g=d3.extent(i,k),(!d||g[0]<d)&&(d=g[0]),(!e||g[1]>e)&&(e=g[1]);var l=[b,c],m=[d,e],n=new Date(l[0]),o=new Date(l[0]);o.setDate(o.getDate()+w),B.domain([n,o]);var p=new Date(l[1]);p.setDate(p.getDate()-w);var q=[n,p];D.domain(q),C.domain(m),H.load(),J.load(),O.load(q,l,m);for(h in a)a[h].id=h,L[h].load(l,m,a[h])}for(var p=m.width||b,q=m.height||c,r=m.margin||{left:d,top:e,right:f,bottom:g},s=m.xAxisLabelText,t=m.xAxisLabelOffset||h,u=m.yAxisLabelText,v=m.yAxisLabelOffset||i,w=m.windowSize||j,x=m.xColumn||k,y=m.yColumn||l,z=p-r.left-r.right,A=q-r.top-r.bottom,B=d3.time.scale().range([0,z]),C=d3.scale.linear().range([A,0]),D=d3.time.scale().range([0,z]),E=new exp.container(a,p,q,r),F=E.getChartArea(),G={type:"x",chartContainer:E,scale:B,labelText:s,labelOffset:t,tickFormat:d3.time.format("%d %b")},H=new exp.axis(G),I={type:"y",chartContainer:E,scale:C,labelText:u,labelOffset:v,tickFormat:d3.format(".3s"),gridlines:!0},J=new exp.axis(I),K={chartArea:F,xCallback:function(a){return B(a[x])},yCallback:function(a){return C(a[y])},xScale:B,yScale:C,xGuidelines:!0},L=[],M=0;M<n.length;M++)L.push(new exp.line(K));var N={chartContainer:E,scale:D,labelText:"Date",tickFormat:d3.time.format("%d %b"),windowSize:w,xAxisScale:B,xAxis:H,lines:L},O=new exp.controls.player(N);o(n)}exp.charts.motionChart=a;var b=500,c=320,d=70,e=10,f=15,g=100,h=48,i=40,j=5,k="x",l="y"}(),function(){function a(a){function d(){var a=h.brush.extent()[0];a==h.axisExtent[1].getTime()&&(k=!0),g();var b=d3.event.sourceEvent&&d3.event.sourceEvent.constructor==MouseEvent&&"click"!=d3.event.sourceEvent.type;b&&(a=h.scale.invert(d3.mouse(this)[0]),h.brush.extent([a,a])),o.attr("cx",h.scale(a));var c=a,d=new Date(c);d.setDate(d.getDate()+h.windowSize),h.xAxisScale.domain([c,d]),h.xAxis.load();for(var e in h.lines)h.lines[e].load(h.xExtent,h.yExtent)}function e(){if(j=!j,k)return k=!k,void f();var a=[h.axisExtent[1],h.axisExtent[1]],b=h.brush.extent();j?n.transition().duration(0).call(h.brush.extent(h.brush.extent())):n.transition().ease("linear").duration(function(){return h.speed*((h.axisExtent[1]-h.brush.extent()[0])/(h.axisExtent[1]-h.axisExtent[0]))}).each("interrupt",function(){j=!0,g()}).call(h.brush.extent(a)).tween("brush",function(){var c=d3.interpolate(b,a);return function(a){n.call(h.brush.extent(c(a))),n.call(h.brush.event)}})}function f(){n.call(h.brush.extent([h.axisExtent[0],h.axisExtent[0]])).call(h.brush.event)}function g(){k?m.text(""):m.text(function(a){return j?"":""})}var h=this;h.chartContainer=a.chartContainer,h.scale=a.scale,h.labelText=a.labelText||"",h.ticks=a.ticks||9,h.tickFormat=a.tickFormat,h.windowSize=a.windowSize,h.xAxisScale=a.xAxisScale,h.xAxis=a.xAxis,h.lines=a.lines,h.speed=a.speed||2e4,h.axisExtent=null,h.xExtent=null,h.yExtent=null;var i=h.chartContainer.getChartArea(),j=!0,k=!1;h.scale.clamp(!0),h.axisG=i.append("g").attr("class","player axis").attr("transform","translate(0,"+(h.chartContainer.getHeight()+b)+")");h.axisG.append("text").style("text-anchor","middle").attr("transform","translate("+h.chartContainer.getWidth()/2+","+c+")").attr("class","label").text(h.labelText);h.axis=d3.svg.axis().scale(h.scale).orient("bottom").ticks(h.ticks).outerTickSize(0).tickFormat(h.tickFormat);var l=i.append("g").attr("class","play-pause").attr("transform","translate(-50,"+(h.chartContainer.getHeight()+55)+")");l.append("rect").attr("width",30).attr("height",30);var m=l.append("text").attr("font-family","FontAwesome").attr("font-size",15).attr("x",8).attr("y",20);l.on("click",e),g(),h.brush=d3.svg.brush().extent([h.scale.invert(0),h.scale.invert(0)]).x(h.scale).on("brush",d);var n=i.append("g").attr("class","slider").call(h.brush);n.selectAll(".extent,.resize").remove(),n.select(".background").attr("height",30).attr("transform","translate(0,"+(h.chartContainer.getHeight()+55)+")");var o=n.append("circle").attr("class","handle").attr("transform","translate(0,"+(h.chartContainer.getHeight()+70)+")").attr("r",9)}exp.controls.player=a;var b=70,c=48;a.prototype.load=function(a,b,c){this.axisG.call(this.axis),this.axisG.select(".domain").select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","bar"),this.axisExtent=a,this.xExtent=b,this.yExtent=c;var d=[this.axisExtent[0],this.axisExtent[0]];this.brush.extent(d)},a.prototype.getScale=function(){return this.scale}}(),function(){function a(a){var b=this;b.chartArea=a.chartArea,b.xFormat=a.xFormat,b.yFormat=a.yFormat,b.color=a.color,b.container=b.chartArea.append("g").style("opacity",0).attr("class","tooltip"),b.container.append("rect").attr("height",50).attr("width",150).style("stroke",b.color),b.xNode=b.container.append("text").attr("x",10).attr("y",15).attr("class","x-node").style("fill",b.color),b.yNode=b.container.append("text").attr("x",10).attr("y",40).attr("class","y-node"),b.container.on("mouseout",function(){b.hide()})}exp.tooltip=a,a.prototype.render=function(a,b,c,d,e){c=this.xFormat(c),d=this.yFormat(d),this.xNode.text(c),this.yNode.text(d),this.container.attr("transform","translate("+a+","+b+")").transition().duration(e||200).style("opacity",1)},a.prototype.hide=function(){this.container.style("opacity",0)},a.prototype.setColor=function(a){this.color=a,this.container.select("rect").style("stroke",this.color),this.xNode.style("fill",this.color)}}();